<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title> Out Write the Storm – Beato's Deli</title>
<style>
  body {
    text-align: center;
    font-family: sans-serif;
    margin: 0;
    padding: 20px;
    background: #cce0ff; /* sky blue */
  }

  #timer {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  #animation-area {
    width: 90%;
    max-width: 800px;
    height: 300px;
    margin: 0 auto 20px auto;
    border: 1px solid #aaa;
    border-radius: 8px;
    position: relative;
    background: linear-gradient(#cce0ff, #ffffff);
  }

  #write-area {
    width: 90%;
    max-width: 800px;
    height: 200px;
    font-size: 16px;
    padding: 10px;
    border: 1px solid #aaa;
    border-radius: 8px;
    resize: vertical;
  }

  a.back {
    display: inline-block;
    margin-top: 20px;
    text-decoration: none;
    color: blue;
  }
</style>
</head>
<body>

<h1>Out write the storm</h1>
<p>Write whatever comes to mind! You have 5 minutes. Watch the climber!</p>

<div id="timer">05:00</div>
<canvas id="animation-area"></canvas>
<textarea id="write-area" placeholder="Start typing here..."></textarea>
<br>
<a class="back" href="index.html">← Back to Beato's Deli</a>

<script>
const canvas = document.getElementById('animation-area');
const ctx = canvas.getContext('2d');
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

const timerElement = document.getElementById('timer');
let totalSeconds = 5 * 60;

// climber settings
const mountainBase = canvas.height - 50;
const mountainPeak = 50;
let climberY = mountainBase;
const climberX = canvas.width/2 - 10;

// storm elements
let stormIntensity = 0;
const clouds = [];
const raindrops = [];

// create clouds
for(let i=0; i<5; i++){
  clouds.push({x: Math.random()*canvas.width, y: Math.random()*50 + 10, speed: 0.3 + Math.random()*0.5});
}

// create raindrops
for(let i=0; i<100; i++){
  raindrops.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, length: 5+Math.random()*10, speed: 2+Math.random()*3});
}

// TIMER
function updateTimer() {
  let minutes = Math.floor(totalSeconds / 60);
  let seconds = totalSeconds % 60;
  timerElement.textContent = 
      (minutes < 10 ? '0' : '') + minutes + ':' + 
      (seconds < 10 ? '0' : '') + seconds;
  
  if (totalSeconds > 0) {
    totalSeconds--;
  } else {
    clearInterval(timerInterval);
    document.getElementById('write-area').disabled = true;
    alert("Time's up! Great job on your free write.");
  }
}
const timerInterval = setInterval(updateTimer, 1000);

// ANIMATION
function drawMountain() {
  ctx.fillStyle = "#555";
  ctx.beginPath();
  ctx.moveTo(0, mountainBase);
  ctx.lineTo(canvas.width/2, mountainPeak);
  ctx.lineTo(canvas.width, mountainBase);
  ctx.closePath();
  ctx.fill();
}

function drawClimber() {
  ctx.fillStyle = "#ff0000";
  ctx.fillRect(climberX, climberY - 20, 20, 20);
}

function drawStorm() {
  // clouds
  ctx.fillStyle = "rgba(150,150,150," + stormIntensity + ")";
  clouds.forEach(c => {
    ctx.beginPath();
    ctx.ellipse(c.x, c.y, 40, 20, 0, 0, Math.PI*2);
    ctx.fill();
    c.x += c.speed;
    if(c.x - 40 > canvas.width) c.x = -40;
  });

  // raindrops
  ctx.strokeStyle = `rgba(0,0,255,${stormIntensity})`;
  raindrops.forEach(r => {
    ctx.beginPath();
    ctx.moveTo(r.x, r.y);
    ctx.lineTo(r.x, r.y + r.length);
    ctx.stroke();
    r.y += r.speed * stormIntensity;
    if(r.y > canvas.height) r.y = -r.length;
  });

  // occasional lightning
  if(Math.random() < 0.02 * stormIntensity){
    ctx.strokeStyle = "yellow";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(Math.random()*canvas.width, 0);
    ctx.lineTo(Math.random()*canvas.width, canvas.height/2);
    ctx.stroke();
  }
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMountain();

  const elapsed = 5*60 - totalSeconds;

  if(elapsed <= 150){ // climb up first 2:30
    climberY = mountainBase - ((mountainBase - mountainPeak)*(elapsed/150));
  } else { // descend next 2:30
    const downTime = elapsed - 150;
    climberY = mountainPeak + ((mountainBase - mountainPeak)*(downTime/150));
    stormIntensity = downTime/150;
  }

  drawClimber();
  drawStorm();

  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
